---
import Base from '../layouts/Base.astro';
import { trades } from '../data';
import { ModernHero } from '../components/hero/ModernHero';
import HomeTestimonials from '../components/home/HomeTestimonials.astro';
import HomePopularTrades from '../components/home/HomePopularTrades.astro';
import HomeHowItWorks from '../components/home/HomeHowItWorks.astro';
import HomeTrustSafety from '../components/home/HomeTrustSafety.astro';
import HomeFAQ from '../components/home/HomeFAQ.astro';
import HomeFinalCTA from '../components/home/HomeFinalCTA.astro';
import { generateHomepageSchema } from '../lib/schema';

// APP_URL not needed on homepage (uses Base layout which sets it)

// Stats - în producție ar veni din API
const stats = {
  totalWorkers: 150,
  totalCities: 45,
  totalTrades: trades.length,
  totalReviews: 320
};

// Generate structured data
const schemaData = generateHomepageSchema(stats, trades);
---

<Base 
  title="Meserias Local - Găsește Meseriași Profesioniști în România"
  description="Platforma ta de încredere pentru găsirea meseriașilor profesioniști. Compară oferte, vezi recenzii reale și contactează meseriași verificați."
>
  <script type="application/ld+json" set:html={JSON.stringify(schemaData)} slot="head" />
  <!-- Hero Section cu React Component -->
  <ModernHero client:idle trades={trades} stats={stats} />

  <!-- Testimonials Section -->
  <HomeTestimonials />

  <!-- Popular Trades Section -->
  <HomePopularTrades trades={trades} />

  <!-- How It Works Section -->
  <HomeHowItWorks />

  <!-- Trust & Safety Section -->
  <HomeTrustSafety />

  <!-- FAQ Section -->
  <HomeFAQ />

  <!-- Final CTA Section -->
  <HomeFinalCTA />

  <!-- Analytics Tracking Script -->
  <script is:inline>
    // Track CTA clicks
    document.addEventListener('DOMContentLoaded', () => {
      // Track "Cere Ofertă" buttons
      document.querySelectorAll('a[href*="cere-oferta"], button[data-action="cere-oferta"]').forEach(btn => {
        btn.addEventListener('click', () => {
          if (window.dataLayer) {
            window.dataLayer.push({
              event: 'cere_oferta_click',
              category: 'conversion',
              action: 'click',
              label: 'homepage_cta',
              page_location: window.location.href
            });
          }
        });
      });

      // Track service card clicks
      document.querySelectorAll('a[href*="/servicii/"]').forEach(link => {
        link.addEventListener('click', function() {
          const service = this.getAttribute('href')?.split('/').filter(Boolean).pop() || 'unknown';
          if (window.dataLayer) {
            window.dataLayer.push({
              event: 'service_click',
              category: 'engagement',
              action: 'click',
              service: service,
              source: 'homepage'
            });
          }
        });
      });

      // Track search interactions
      const searchInput = document.querySelector('input[type="search"], input[placeholder*="Caută"]');
      if (searchInput) {
        searchInput.addEventListener('focus', () => {
          if (window.dataLayer) {
            window.dataLayer.push({
              event: 'search_focus',
              category: 'engagement',
              action: 'focus',
              label: 'homepage_search'
            });
          }
        });
      }
    });
  </script>
</Base>
